#include "view.h"

#include <algorithm>
#include <iomanip>
#include <iostream>

// å®šä¹‰å„ç§å¯çˆ±çš„é¢œè‰²é­”æ³•~
const std::string View::RED = "\033[31m";  // å°è‰è“çº¢è‰²ï¼Œç”¨æ¥æé†’é‡è¦äº‹é¡¹å“Ÿ~
const std::string View::BLUE = "\033[34m";  // å¤©ç©ºè“è‰²ï¼Œåƒæ¸…çˆ½çš„æµ·æ´‹ä¸€æ ·~
const std::string View::GREEN = "\033[32m";  // å«©èŠ½ç»¿è‰²ï¼Œä»£è¡¨å¸Œæœ›å’ŒæˆåŠŸå‘¢~
const std::string View::YELLOW = "\033[33m";  // å‘æ—¥è‘µé»„è‰²ï¼Œæ¸©æš–åˆæ´»æ³¼å“’~
const std::string View::WHITE = "\033[0m";  // çº¯å‡€ç™½è‰²ï¼Œåƒå°æ£‰èŠ±ä¸€æ ·æŸ”è½¯~
const std::string View::CYAN = "\033[36m";  // æ¢¦å¹»è“è‰²ï¼Œå……æ»¡ç¥ç§˜æ„Ÿå‘¢~

// æ¬¢è¿ç•Œé¢çš„å°ä»™å¥³~ç”¨æ¼‚äº®çš„ASCIIè‰ºæœ¯æ¥è£…é¥°å“Ÿ~
void View::DisplayHeader() {
    std::cout << BLUE << CYAN << R"(
       âœ¿ _______________
      /  âˆ—            âˆ— \
     /   â‹†             â‹† \
    |  âœ§_______________âœ§  |
    | |  â‹†           â‹†  | |
    | |   \033[37mâ™¡â™¡â™¡â™¡â™¡â™¡â™¡â™¡\033[36m    | |
    | |   \033[37mâ™¡ \033[36mPHONE \033[37mâ™¡\033[36m  | |
    | |   \033[37mâ™¡â™¡â™¡â™¡â™¡â™¡â™¡â™¡\033[36m    | |
    | |  â‹†           â‹†  | |
    | |_______________| |
    |      âœ¿[â™¡]âœ¿       |
     \   â‹†         â‹†   /
      \_______________/

    â•­â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•®
    â”‚     âœ§ Android æ‰‹æœºå–è¯å·¥å…· v1.0.0 âœ§                        
    â”‚     (å®‰å“æ•°æ®æå–ä¸åˆ†æç³»ç»Ÿ)                                 
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    â•­â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•®
    â”‚  æ³•å¾‹ä¾æ® â™¡                                                
    â”‚  â€¢ ã€Šä¸­åäººæ°‘å…±å’Œå›½åˆ‘äº‹è¯‰è®¼æ³•ã€‹ç¬¬138æ¡                        
    â”‚    - å…³äºç”µå­æ•°æ®æ”¶é›†ä¸ä½¿ç”¨çš„è§„å®š                            
    â”‚  â€¢ ã€Šä¸­åäººæ°‘å…±å’Œå›½ç½‘ç»œå®‰å…¨æ³•ã€‹ç¬¬50æ¡                         
    â”‚    - ç½‘ç»œè¿è¥è€…é…åˆç½‘ç»œå®‰å…¨ä¸ä¿¡æ¯å†…å®¹ç®¡ç†                     
    â”‚  â€¢ ã€Šä¸­åäººæ°‘å…±å’Œå›½å…¬å®‰æœºå…³åŠç†åˆ‘äº‹æ¡ˆä»¶ç¨‹åºè§„å®šã€‹ç¬¬234æ¡         
    â”‚    - ç”µå­æ•°æ®å–è¯ç¨‹åºä¸è¦æ±‚                                
    â”‚  â€¢ ã€Šä¸­åäººæ°‘å…±å’Œå›½ç”µå­ç­¾åæ³•ã€‹ç¬¬14æ¡                         
    â”‚    - ç”µå­ç­¾åçš„æ³•å¾‹æ•ˆåŠ›                                    
    â”‚  â€¢ ã€Šç”µå­æ•°æ®å–è¯è§„èŒƒã€‹GA/T 1070-2013                       
    â”‚    - ç§»åŠ¨è®¾å¤‡å–è¯æŠ€æœ¯æ ‡å‡†                                  
    â”‚  â€¢ ã€Šç§»åŠ¨äº’è”ç½‘åº”ç”¨ç¨‹åºä¿¡æ¯å®‰å…¨ç®¡ç†è§„å®šã€‹                      
    â”‚    - APPæ•°æ®å®‰å…¨ä¸éšç§ä¿æŠ¤è¦æ±‚                             
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    â•­â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•®
    â”‚  è­¦å‘Šäº‹é¡¹ âš                                                
    â”‚  â€¢ æœªç»æˆæƒçš„æ•°æ®æå–å¯èƒ½æ„æˆè¿æ³•è¡Œä¸º                         
    â”‚    - å¯èƒ½è¿åã€Šåˆ‘æ³•ã€‹ç¬¬285æ¡                               
    â”‚    - å¯èƒ½è¿åã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ç›¸å…³è§„å®š                       
    â”‚  â€¢ æå–çš„æ•°æ®å¯èƒ½æ¶‰åŠä¸ªäººéšç§ï¼Œè¯·ä¾æ³•å¤„ç†                      
    â”‚    - éœ€éµå®ˆæ•°æ®ä¿å¯†åŸåˆ™                                    
    â”‚    - ç¡®ä¿æ•°æ®å­˜å‚¨å®‰å…¨                                      
    â”‚  â€¢ å»ºè®®åœ¨è·å¾—åˆæ³•æˆæƒåå†è¿›è¡Œæ•°æ®æå–                         
    â”‚    - è·å–ä¹¦é¢æˆæƒæ–‡ä»¶                                      
    â”‚    - è®°å½•æˆæƒè¿‡ç¨‹                                         
    â”‚  â€¢ ä¸å½“ä½¿ç”¨å¯èƒ½æ‰¿æ‹…æ³•å¾‹è´£ä»»                                 
    â”‚    - æ°‘äº‹èµ”å¿è´£ä»»                                         
    â”‚    - è¡Œæ”¿å¤„ç½šè´£ä»»                                         
    â”‚    - åˆ‘äº‹è´£ä»»                                            
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    â•­â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•®
    â”‚  å…è´£å£°æ˜ â™¡                                               
    â”‚  â€¢ æœ¬å·¥å…·ä»…ä¾›æ‰§æ³•éƒ¨é—¨åœ¨æ³•å¾‹æ¡†æ¶å†…ä½¿ç”¨                          
    â”‚  â€¢ ä½œè€…å¯¹ä»»ä½•éæ³•ä½¿ç”¨æˆ–æ»¥ç”¨æ¦‚ä¸è´Ÿè´£                           
    â”‚  â€¢ ä½¿ç”¨æœ¬å·¥å…·å³è¡¨ç¤ºåŒæ„éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„                        
    â”‚  â€¢ è¯·ç¡®ä¿åœ¨åˆæ³•åˆè§„çš„å‰æä¸‹ä½¿ç”¨æœ¬å·¥å…·                         
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    â•­â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•®
    â”‚  å¼€å‘ä¿¡æ¯ â™¡                                                
    â”‚  ä½œè€…: é’Ÿæ™ºå¼º
    |  ç”µé‚®ï¼šjohnmelodymel@qq.com                                                  
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
)" << WHITE << std::endl;
}

// å°ç™¾ç§‘å…¨ä¹¦åœ¨æ­¤~å±•ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤çš„é­”æ³•æ‰‹å†Œå“Ÿ~(à¹‘â€¢. â€¢à¹‘)
// ä¼šç”¨å½©è™¹è‰²æ–‡å­—åˆ—å‡ºå„ç§æ“ä½œæŒ‡ä»¤ï¼Œè¶…è¯¦ç»†å“’~
void View::DisplayHelp() {
    // æ¼‚äº®çš„èœå•è¾¹æ¡†~
    std::cout << CYAN << "\nâ•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â™¡ åŠŸèƒ½èœå• Features â™¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®"
              << WHITE << std::endl;

    // æ•°æ®æå–åŠŸèƒ½åŒºåŸŸ~
    std::cout << BLUE << "\nâœ§ æ•°æ®æå– Data Extraction âœ§" << WHITE << std::endl;
    std::cout << BLUE << "  [1] " << WHITE << "ğŸ“± Dump Call Logs   å¯¼å‡ºé€šè¯è®°å½•"
              << std::endl;
    std::cout << BLUE << "  [2] " << WHITE << "ğŸ’Œ Dump SMS         å¯¼å‡ºçŸ­ä¿¡"
              << std::endl;
    std::cout << BLUE << "  [3] " << WHITE << "ğŸ“¸ Dump Photos      å¯¼å‡ºç…§ç‰‡"
              << std::endl;
    std::cout << BLUE << "  [4] " << WHITE << "ğŸ¥ Dump Videos      å¯¼å‡ºè§†é¢‘"
              << std::endl;
    std::cout << BLUE << "  [5] " << WHITE << "ğŸ“¦ Dump APKs        å¯¼å‡ºåº”ç”¨"
              << std::endl;
    std::cout << BLUE << "  [6] " << WHITE << "ğŸ“¤ Upload Files     ä¸Šä¼ æ–‡ä»¶"
              << std::endl;
    std::cout << BLUE << "  [7] " << WHITE << "ğŸ“‘ Dump Documents   å¯¼å‡ºæ–‡æ¡£"
              << std::endl;
    std::cout << BLUE << "  [8] " << WHITE << "ğŸ” Extract Info     æå–æ•æ„Ÿä¿¡æ¯"
              << std::endl;

    // ç³»ç»Ÿä¿¡æ¯åŠŸèƒ½åŒºåŸŸ~
    std::cout << BLUE << "\nâœ§ ç³»ç»Ÿä¿¡æ¯ System Info âœ§" << WHITE << std::endl;
    std::cout << BLUE << "  [9]  " << WHITE << "ğŸ“¶ WiFi Info       è·å–WiFiä¿¡æ¯"
              << std::endl;
    std::cout << BLUE << "  [10] " << WHITE << "âš™ï¸  System Info    ç³»ç»Ÿä¿¡æ¯"
              << std::endl;
    std::cout << BLUE << "  [11] " << WHITE << "ğŸ“± List Packages  åº”ç”¨åˆ—è¡¨"
              << std::endl;
    std::cout << BLUE << "  [12] " << WHITE << "ğŸ’¬ WhatsApp Data  æå–WhatsApp"
              << std::endl;
    std::cout << BLUE << "  [13] " << WHITE << "ğŸŒ Browser Data   æµè§ˆå™¨æ•°æ®"
              << std::endl;
    std::cout << BLUE << "  [14] " << WHITE << "ğŸ”” Notifications  é€šçŸ¥è®°å½•"
              << std::endl;
    std::cout << BLUE << "  [15] " << WHITE << "ğŸ’­ WeChat Data    æå–å¾®ä¿¡æ•°æ®"
              << std::endl;

    // å¸¸ç”¨å‘½ä»¤åŒºåŸŸ~
    std::cout << GREEN << "\nâœ§ å¸¸ç”¨å‘½ä»¤ Commands âœ§" << WHITE << std::endl;
    std::cout << YELLOW << "  â­ " << WHITE
              << "1-15: Execute feature  æ‰§è¡Œå¯¹åº”åŠŸèƒ½" << std::endl;
    std::cout << YELLOW << "  â­ " << WHITE << "help/?:  Show help    æ˜¾ç¤ºå¸®åŠ©"
              << std::endl;
    std::cout << YELLOW << "  â­ " << WHITE << "about:   Show about   å…³äºç¨‹åº"
              << std::endl;
    std::cout << YELLOW << "  â­ " << WHITE << "clear:   Clear screen æ¸…å±"
              << std::endl;
    std::cout << YELLOW << "  â­ " << WHITE << "exit/0:  Exit program é€€å‡ºç¨‹åº"
              << std::endl;

    // åº•éƒ¨è£…é¥°è¾¹æ¡†~
    std::cout << CYAN << "\nâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"
              << WHITE << std::endl;
}

// è®¾å¤‡çŠ¶æ€å°åŠ©æ‰‹~éšæ—¶æ±‡æŠ¥è®¾å¤‡è¿æ¥æƒ…å†µå“Ÿ~
void View::ShowDeviceStatus(bool connected, const std::string& model) {
    std::cout << YELLOW << "\n[-] Connected Device/å·²è¿æ¥è®¾å¤‡:" << WHITE
              << std::endl;
    if (connected) {
        std::cout << GREEN << "[+] " << model << WHITE << std::endl;
    } else {
        std::cout << RED << "[!] No mobile phone detected/æœªæ£€æµ‹åˆ°æ‰‹æœºè®¾å¤‡"
                  << WHITE << std::endl;
    }
    // Decorative border for device status
    std::cout << CYAN << "\nâ•­â”€â”€â”€â”€ Device Status è®¾å¤‡çŠ¶æ€ â”€â”€â”€â”€â•®" << WHITE
              << std::endl;
    if (connected) {
        std::cout << GREEN << "  âœ“ è®¾å¤‡å·²è¿æ¥ Device Connected" << std::endl;
        std::cout << "  ğŸ“± å‹å· Model: " << model << WHITE << std::endl;
    } else {
        std::cout << RED << "  âœ— æœªæ£€æµ‹åˆ°è®¾å¤‡ No Device" << std::endl;
        std::cout << "  ğŸ’¡ è¯·æ£€æŸ¥è¿æ¥ Check Connection" << WHITE << std::endl;
    }
    std::cout << CYAN << "â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯" << WHITE << std::endl;
}

// è¿›åº¦æ¡å°ç²¾çµ~ç”¨å¯çˆ±çš„æ–¹å¼æ˜¾ç¤ºä»»åŠ¡è¿›åº¦å‘¢~
void View::ShowProgress(const std::string& operation, int percentage) {
    std::cout << GREEN << "\r[*] " << operation << " [";
    int pos = 50 * percentage / 100;
    for (int i = 0; i < 50; ++i) {
        if (i < pos)
            std::cout << "=";
        else if (i == pos)
            std::cout << ">";
        else
            std::cout << " ";
    }
    std::cout << "] " << std::setw(3) << percentage << "%" << std::flush;
    if (percentage == 100) std::cout << std::endl;
}

// é”™è¯¯æç¤ºå°å¤©ä½¿~ç”¨æ¸©æŸ”çš„æ–¹å¼å‘Šè¯‰ç”¨æˆ·å‡ºé”™å•¦~
void View::ShowError(const std::string& message) {
    std::cout << RED << "[!] Error/é”™è¯¯: " << message << WHITE << std::endl;
}

// æˆåŠŸæç¤ºå°ä»™å­~å¼€å¿ƒåœ°åº†ç¥ä»»åŠ¡å®Œæˆå•¦~
void View::ShowSuccess(const std::string& message) {
    std::cout << GREEN << "[+] Success/æˆåŠŸ: " << message << WHITE << std::endl;
}

// æ¶ˆæ¯ä¼ é€’å°ç²¾çµ~ç”¨æ¼‚äº®çš„é¢œè‰²æ˜¾ç¤ºå„ç§æç¤ºå“Ÿ~
void View::ShowMessage(const std::string& message, const std::string& color) {
    std::cout << color << "[*] " << message << WHITE << std::endl;
}

// ç”¨æˆ·è¾“å…¥å°åŠ©æ‰‹~æ¸©æŸ”åœ°ç­‰å¾…ç”¨æˆ·çš„æŒ‡ä»¤å‘¢~
void View::GetInput(const std::string& prompt, std::string& input) {
    std::cout << YELLOW << prompt << WHITE;
    std::getline(std::cin, input);
}

// æ¸…å±å¹•å°é­”æ³•å¸ˆ~è®©ç•Œé¢ä¿æŒæ•´æ´å¹²å‡€å‘¢~
void View::ClearScreen() {
#ifdef _WIN32
    system("cls");  // Windowsç³»ç»Ÿä¸‹çš„æ¸…å±é­”æ³•~
#else
    system("clear");  // Unixç³»ç»Ÿä¸‹çš„æ¸…å±é­”æ³•~
#endif
}

// ç³»ç»Ÿæ£€æµ‹å°èƒ½æ‰‹~å¸®å¿™è¯†åˆ«å½“å‰è¿è¡Œçš„ç³»ç»Ÿç±»å‹å“Ÿ~
std::string View::GetOSType() {
#ifdef _WIN32
    return "Windows";  // Windowsç³»ç»Ÿå°±è¿”å›è¿™ä¸ª~
#elif __APPLE__
    return "MacOS";  // è‹¹æœç³»ç»Ÿå°±è¿”å›è¿™ä¸ª~
#elif __linux__
    return "Linux";  // Linuxç³»ç»Ÿå°±è¿”å›è¿™ä¸ª~
#elif __unix__
    return "Unix";  // Unixç³»ç»Ÿå°±è¿”å›è¿™ä¸ª~
#else
    return "Unknown OS";  // ä¸è®¤è¯†çš„ç³»ç»Ÿå°±è¿™æ ·è¯´å•¦~
#endif
}